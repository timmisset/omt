plugins {
    id 'java'
    id 'org.jetbrains.intellij' version '0.4.7'
    id 'jacoco'
}

group 'com.misset'
version '1.3'

sourceCompatibility = 1.8
sourceSets.main.java.srcDirs 'src/main/gen'

repositories {
    mavenCentral()
}

dependencies {
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.3.1'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.3.1'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-params:5.3.1'
    testCompile group: 'org.mockito', name: 'mockito-inline', version: '3.4.6'
    testCompile 'org.junit.jupiter:junit-jupiter-params:5.3.1'
    compile group: 'com.atlassian.commonmark', name: 'commonmark', version: '0.2.0'
    compile group: 'org.apache.jena', name: 'jena', version: '3.16.0', ext: 'pom' exclude group: 'org.slf4j'
    compile group: 'org.apache.jena', name: 'jena-core', version: '3.16.0' exclude group: 'org.slf4j'
    compile group: 'commons-io', name: 'commons-io', version: '2.8.0'
}
test {
    useJUnitPlatform()
    // used for ITs
    systemProperty "idea.home.path", "C:/Program Files/JetBrains/IntelliJ IDEA Community Edition 2020.2"
    finalizedBy jacocoTestReport // report is always generated after tests run
}
jacocoTestReport {
    dependsOn test // tests are required to run before generating the report
}

// See https://github.com/JetBrains/gradle-intellij-plugin/
intellij {
    version '2020.2'
    plugins = ['java']
}
patchPluginXml {
    changeNotes """
      RDF model is now included in completion provider and annotations
      Requires Apache Jena which has increased the size of the plugin signifanctly
      Assumes the OPP root.ttl information to be available
      
      Completion for imports
      Warnings when completions are unused and removal intention
      """
}
tasks{
    runIde {
        jvmArgs("-Xmx2000m")
    }
}
